<!DOCTYPE html>
<html lang="">

<head>
    <style>
    label{
        color: red;
    }
    </style>
</head>

<body>
    <div class="w-100 page-header">
        <h4 class="page-title" id="userProfile"></h4>
    </div>
        <div class="col-md-8 mx-auto my-4">
            <form id="formAddUser">
                    <input class="form-control" id="userId" name="userId" hidden/>
                <div class="form-group row">
                    <label for="userNameInput" class="col-sm-3 col-form-label" id="userNameLabel">User Name</label>
                    <div class="col-sm-9">
                            <input class="form-control" id="userName" name="userName" disabled/>
                    </div>
                </div>
                <!-- <div class="form-group row">
                    <label for="passWordInput" class="col-sm-3 col-form-label" id="passWordLabel">Password
                    </label> 
                </div> -->
                <div class="form-group row">
                    <label for="userEmailInput" class="col-sm-3 col-form-label" id="userEmailLabel">Email

                    </label>
                    <div class="col-sm-9">
                            <input class="form-control" id="userEmail" name="userEmail" required/>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="userFullNameInput" class="col-sm-3 col-form-label" id="userFullNameLabel">user Full
                        Name
                    </label>
                    <div class="col-sm-9">
                            <input class="form-control" id="userFullName" name="userFullName" required/>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="userPhoneInput" class="col-sm-3 col-form-label" id="userPhoneLabel">User Phone
                    </label>
                    <div class="col-sm-9">
                        <input class="form-control" id="userPhone" name="userFullName" required/>
                    </div>
                </div>
                
                <hr />
                <div class="w-100 d-flex justify-content-around">

                    <input type="button" id="saveProfile" class="btn btn-info" value="Add user">
                    <!-- <button type="button" class="btn btn-danger" id="cancelBtn" onclick="redirectLinks('gotoAllUsers.go')">cancel</button> -->
<button type="button" data-toggle="modal" data-target="#changePassModal" class="btn btn-link" id="changePass"></button>
                </div>
              
            </form>
        </div>


        <div class="modal fade" id="changePassModal" tabindex="-1" role="dialog" aria-labelledby="changePassTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="changePassTitle">Modal title</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                    <form id="changePassForm">
                        <div class="form-group">
                            <input type="password" class="form-control" id="currPass" name="currPass" placeholder="Current Password" required />
                            <label class="error2 d-none" id="curPassError"></label>
                        </div>
                        <div class="form-group">
                            <input type="password" class="form-control" id="newPass" name="newPass" placeholder="New Password" required />
                            
                        </div>
                        <div class="form-group">
                            <input type="password" class="form-control" id="confirmNewPass" name="confirmNewPass" placeholder="Confirm New Password" required />
                            <label class="error2 d-none" id="newPassError"></label>
                        </div>
                        <div class="row">
                            <button type="submit" id="saveNewPassword" class="btn btn-secondary mx-auto">Save changes</button>
                        </div>
                    </form>
                </div>
                
              </div>
            </div>
          </div>



        <script src="plugins/js/jquery.validate.min.js"></script>
        <!-- <script id="arMessages" src="plugins/ar/messages_ar.min.js"></script> -->
        
        <script>
            //========= Read data depending on language ====================
             readData() 

            //================= Read user data =-===================
                $("#userName").val("${webuser.username}");
                $("#userEmail").val("${webuser.email}");
                $("#userFullName").val("${webuser.fullName}");
                $("#userPhone").val("${webuser.phone}");


            //================= update user data ====================
            var userData;
            $("#formAddUser").validate();
            $("#saveProfile").click(function(e){
                e.preventDefault()
                if($("#formAddUser").valid()){
                    userData = {
                    "userName" : $("#userName").val(),
                    "email" : $("#userEmail").val(),
                    "fullName" : $("#userFullName").val(),
                    "phone" : $("#userPhone").val(),   
                    }
                    $.ajax({
                    url: "webuser/"+userId,
                    type: "PUT",
                    dataType: 'json',
                    data: userData,
                    success: function (result) {
                        var status = result.status;
                        setTimeout(function(){
                            showMessage(status,result.message)
                        },100)
                        
                    }, error: function (result) {
                        var status = result.status;
                        setTimeout(function(){
                            showMessage(false, status)
                    },100)
                    }
                });
                console.log(userData);
                } else {
                    return false
                }
            })


            //================= update user data ====================
            $("#changePassForm").validate();
            $("#changePassForm").submit(function(e){
                e.preventDefault();
                var curentPassFromDB = "admin";
                //------------------------
               
                var newwPass = $("#newPass").val();
                var confirmNewPass = $("#confirmNewPass").val();
                if($("#changePassForm").valid()){
                    //======== new password confirm ==============
                    if(newwPass === confirmNewPass){
                            $("#newPassError").addClass("d-none")
                        } else {
                            $("#newPassError").removeClass("d-none")
                            return false
                        }
                    //======== new password confirm end ==============
                    //======== password ajax ============================
                    $.ajax({
                    url: "webuser/"+userId,
                    type: "POST",
                    dataType: 'json',
                    data: {
                        "password": $("#currPass").val(),
                        "newPassword": $("#newPass").val()
                    },
                    success: function (result) {
                        var status = result.status;
                        setTimeout(function(){
                            showMessage(status,result.message)
                        },100)
                        
                    }, error: function (result) {
                        var status = result.status;
                        setTimeout(function(){
                            showMessage(false, status)
                    },100)
                    }
                });
                    // if(currentPassForm === curentPassFromDB){
                    //     $("#curPassError").addClass("d-none")
                        
                    // } else {
                    //     $("#curPassError").removeClass("d-none")
                    //     return false
                    // }
                }

            })

        </script>
</body>

</html>